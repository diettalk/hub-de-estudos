<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HUB H√©lio - A Plataforma Definitiva</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .tab-button { transition: all 0.2s ease-in-out; border-bottom: 3px solid transparent; padding: 1rem; }
        .tab-button.active { border-color: #3B82F6; color: #1E3A8A; font-weight: 700; }
        .tab-content { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .input-style { background-color: #F9FAFB; border: 1px solid #D1D5DB; color: #111827; font-size: 0.875rem; border-radius: 0.5rem; padding: 0.6rem; width: 100%; transition: all 0.2s; }
        .input-style:focus { box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.4); border-color: #2563EB; outline: none; }
        .card { background-color: white; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05); }
        .btn { padding: 0.6rem 1.2rem; border-radius: 0.5rem; font-weight: 600; transition: all 0.2s; cursor: pointer; border: none; display: inline-flex; align-items: center; justify-content: center; }
        .btn-primary { background-color: #2563EB; color: white; }
        .btn-primary:hover { background-color: #1D4ED8; }
        .btn-secondary { background-color: #F3F4F6; color: #374151; }
        .btn-secondary:hover { background-color: #E5E7EB; }
        .modal { display: none; }
        .modal.active { display: flex; }

        /* --- Dark Mode Simples --- */
        
        /* CORRE√á√ÉO APLICADA AQUI: A cor de fundo √© aplicada no 'body' */
        html.dark body { background-color: #111827; }

        html.dark .card { background-color: #1f2937; border: 1px solid #374151; }
        html.dark .tab-button.active { color: #60a5fa; border-color: #60a5fa;}
        html.dark .tab-button { color: #9ca3af; }
        html.dark body, html.dark h1, html.dark h2, html.dark h3, html.dark th, html.dark summary, html.dark legend { color: #f9fafb; }
        html.dark p, html.dark span, html.dark li, html.dark label, html.dark td, html.dark details { color: #d1d5db; }
        html.dark .text-gray-500 { color: #9ca3af; }
        html.dark .input-style, html.dark select { background-color: #374151; border-color: #4b5563; color: white;}
        html.dark .bg-gray-50 { background-color: #374151; }
        html.dark .bg-gray-100 { background-color: #374151; }
        html.dark .bg-white { background-color: #1f2937; }
        html.dark .border-b, html.dark .border-t, html.dark .border-l-2, html.dark .border { border-color: #374151; }
        html.dark .btn-secondary { background-color: #374151; color: #d1d5db; }
        html.dark .btn-secondary:hover { background-color: #4b5563; }
    </style>
</head>
<body class="text-gray-800 transition-colors">

    <div id="app" class="container mx-auto p-4 md:p-8">
        
        <header class="flex justify-between items-center mb-10">
            <div><h1 class="text-4xl md:text-5xl font-black">HUB H√©lio</h1><p id="header-subtitle" class="text-gray-500 mt-2 text-lg">A Plataforma Definitiva</p></div>
            <button id="theme-toggle" class="btn btn-secondary text-xl w-12 h-12" title="Alternar Tema"></button>
        </header>

        <div class="mb-8 border-b">
            <nav class="flex flex-wrap -mb-px" aria-label="Tabs">
                <button class="tab-button" onclick="app.showTab('dashboard')"><i class="fas fa-tachometer-alt mr-2"></i>Dashboard</button>
                <button class="tab-button" onclick="app.showTab('guias')"><i class="fas fa-hdd mr-2"></i>Guia de Estudos</button>
                <button class="tab-button" onclick="app.showTab('ciclo')"><i class="fas fa-sync-alt mr-2"></i>Ciclo de Estudos</button>
                <button class="tab-button" onclick="app.showTab('revisoes')"><i class="fas fa-brain mr-2"></i>Revis√µes</button>
                <button class="tab-button" onclick="app.showTab('documentos')"><i class="fas fa-book-open mr-2"></i>Documentos</button>
                <button class="tab-button" onclick="app.showTab('tarefas')"><i class="fas fa-tasks mr-2"></i>Tarefas</button>
                <button class="tab-button" onclick="app.showTab('calendario')"><i class="fas fa-calendar-alt mr-2"></i>Calend√°rio Geral</button>
            </nav>
        </div>

        <main>
            <div id="dashboard" class="tab-content hidden"></div>
            <div id="guias" class="tab-content hidden"></div>
            <div id="ciclo" class="tab-content hidden"></div>
            <div id="revisoes" class="tab-content hidden"></div>
            <div id="documentos" class="tab-content hidden"></div>
            <div id="tarefas" class="tab-content hidden"></div>
            <div id="calendario" class="tab-content hidden"></div>
        </main>
    </div>

    <div id="main-modal-container"></div>
    
    <script>
    const AppData = {
        state: {
            activeTab: 'dashboard',
            activeConcursoId: 'cnu2025',
            theme: 'light',
            quickNotes: 'Revisar Lei 8.112 antes de dormir.',
            user: { name: "H√©lio", gamification: { streak: 5, xp: 45, level: 2, lastLogin: new Date(new Date().setDate(new Date().getDate()-1)).toDateString() } },
            concursos: { 'cnu2025': { id: 'cnu2025', nome: 'CNU 2025 - Bloco 7', banca: 'FGV', dataProva: '2025-10-05', status: 'Edital Previsto', linkEdital: '#', folders: { 'f1': { id: 'f1', name: 'Conhecimentos Gerais' }, 'f2': { id: 'f2', name: 'Eixo 1 - Gest√£o Gov.' } }, disciplinas: { 'd1': { id: 'd1', name: 'L√≠ngua Portuguesa', emoji: 'üáµüáπ', folderId: 'f1' }, 'd2': { id: 'd2', name: 'Gest√£o de Pessoas', emoji: 'üë•', folderId: 'f2' } }, topicos: { 't1': { id: 't1', disciplinaId: 'd1', name: 'Interpreta√ß√£o de Textos', markdown: '## Anota√ß√µes de Interpreta√ß√£o\nFoco em textos filos√≥ficos da FGV.' }, 't2': { id: 't2', disciplinaId: 'd1', name: 'Uso da Crase', markdown: '## Anota√ß√µes de Crase\nLembrar da regra: "Vou a, volto da, crase h√°".' }, }, ciclo: [ { hora: 1, materia: 'LP', foco: '1.1 Interpreta√ß√£o de Textos: An√°lise de textos complexos (jornal√≠sticos).', topicoId: 't1' }, { hora: 2, materia: 'G.GOV', foco: '(Eixo 1) 1.1 Ferramentas de gest√£o: Balanced Scorecard (BSC).', topicoId: null}, { hora: 3, materia: 'G.GOV', foco: '(Eixo 1) 1.2 Matriz SWOT.', topicoId: null }, { hora: 4, materia: 'RLM', foco: '2.1 L√≥gica Proposicional: Estruturas l√≥gicas, conectivos.', topicoId: null }, { hora: 5, materia: 'P.PUB', foco: '(Eixo 2) 1.1 Tipos de pol√≠ticas p√∫blicas: distributivas, regulat√≥rias e redistributivas.', topicoId: null }, { hora: 6, materia: 'SA√öDE/SOCIAL', foco: '(Eixo 3) 3.1 Estrutura e organiza√ß√£o do Sistema √önico de Sa√∫de.', topicoId: null }, { hora: 7, materia: 'LP', foco: '1.5 Morfossintaxe: Emprego das classes de palavras.', topicoId: 't2' }, { hora: 8, materia: 'G.GOV', foco: '(Eixo 1) 2. Gest√£o de pessoas: Lideran√ßa e gerenciamento de conflitos.', topicoId: null }, { hora: 9, materia: 'ADM.P√öB', foco: '(Gerais) 7.1 Princ√≠pios constitucionais da administra√ß√£o p√∫blica (art. 37).', topicoId: null }, { hora: 10, materia: 'RLM', foco: '2.1 L√≥gica Proposicional: Tabela-verdade, nega√ß√£o e equival√™ncias.', topicoId: null }, { hora: 11, materia: 'P.PUB', foco: '(Eixo 2) 4. Pol√≠ticas P√∫blicas e suas fases: forma√ß√£o da agenda e formula√ß√£o.', topicoId: null }, { hora: 12, materia: 'G.GOV', foco: '(Eixo 1) 3. Gest√£o de projetos: conceitos b√°sicos e processos do PMBOK.', topicoId: null }, { hora: 13, materia: 'LP', foco: '1.3 Sem√¢ntica e Vocabul√°rio: Sinon√≠mia, anton√≠mia, polissemia.', topicoId: 't1' }, { hora: 14, materia: 'P.PUB', foco: '(Eixo 2) 4. Pol√≠ticas P√∫blicas e suas fases: implementa√ß√£o, monitoramento e avalia√ß√£o.', topicoId: null }, { hora: 15, materia: 'SA√öDE/SOCIAL', foco: '(Eixo 3) 3.8 Legisla√ß√£o do SUS: Lei n¬∫ 8.080/1990 (Parte 1).', topicoId: null }, { hora: 16, materia: 'RLM', foco: '2.2 An√°lise Combinat√≥ria.', topicoId: null }, { hora: 17, materia: 'P.PUB', foco: '(Eixo 2) 5.1 A√ß√µes afirmativas e compet√™ncias para atua√ß√£o com diversidade.', topicoId: null }, { hora: 18, materia: 'G.GOV', foco: '(Eixo 1) 8. Contrata√ß√µes P√∫blicas (Lei n¬∫ 14.133/2021): Abrang√™ncia e princ√≠pios.', topicoId: null }, { hora: 19, materia: 'LP', foco: '1.4 Coes√£o e Coer√™ncia: Mecanismos e conectores.', topicoId: 't1' }, { hora: 20, materia: 'G.GOV', foco: '(Eixo 1) 4. Gest√£o de riscos: princ√≠pios, objetos e t√©cnicas.', topicoId: null }, { hora: 21, materia: 'ADM.P√öB', foco: '(Gerais) 8.4 No√ß√µes de or√ßamento p√∫blico: PPA, LDO e LOA.', topicoId: null }, { hora: 22, materia: 'RLM', foco: '2.2 Probabilidade.', topicoId: null }, { hora: 23, materia: 'P.PUB', foco: '(Gerais) 3.2 Ciclos de pol√≠ticas p√∫blicas (refor√ßo).', topicoId: null }, { hora: 24, materia: 'SA√öDE/SOCIAL', foco: '(Eixo 3) 3.8 Legisla√ß√£o do SUS: Lei n¬∫ 8.080/1990 (Parte 2).', topicoId: null }, { hora: 25, materia: 'LP', foco: '1.5 Morfossintaxe: Concord√¢ncia verbal e nominal.', topicoId: 't2' }, { hora: 26, materia: 'G.GOV', foco: '(Eixo 1) 5.4 Lei Geral de Prote√ß√£o de Dados Pessoais ‚Äì LGPD.', topicoId: null }, { hora: 27, materia: 'P.PUB', foco: '(Gerais) 1.1 Introdu√ß√£o √†s pol√≠ticas p√∫blicas: conceitos e tipologias (refor√ßo).', topicoId: null }, { hora: 28, materia: 'DH', foco: '(Eixo 4) 1.1 Normas e acordos internacionais: Declara√ß√£o Universal dos Direitos Humanos (1948).', topicoId: null }, { hora: 29, materia: 'P.PUB', foco: '(Eixo 2) 2.1 Poder, racionalidade, discricionariedade na implementa√ß√£o de pol√≠ticas.', topicoId: null }, { hora: 30, materia: 'SA√öDE/SOCIAL', foco: '(Eixo 3) 10. Seguran√ßa Alimentar. Lei Org√¢nica de Seguran√ßa Alimentar e Nutricional (LOSAN).', topicoId: null }, { hora: 31, materia: 'LP', foco: '1.5 Morfossintaxe: Reg√™ncia verbal e nominal; Crase.', topicoId: 't2' }, { hora: 32, materia: 'G.GOV', foco: '(Gerais) 5.2 Governan√ßa p√∫blica e sistemas de governan√ßa (Decreto n¬∫ 9.203).', topicoId: null }, { hora: 33, materia: 'ADM.P√öB', foco: '(Gerais) 7.3 Agentes p√∫blicos: Regime Jur√≠dico √önico (Lei n¬∫ 8.112/1990).', topicoId: null }, { hora: 34, materia: 'RLM', foco: '2.3 Matem√°tica B√°sica: Problemas com porcentagem e regra de tr√™s.', topicoId: null }, { hora: 35, materia: 'P.PUB', foco: '(Eixo 2) 3. Teorias e modelos de an√°lise contempor√¢neos de pol√≠ticas p√∫blicas.', topicoId: null }, { hora: 36, materia: 'SA√öDE/SOCIAL', foco: '(Eixo 3) 3.9 Redes de Aten√ß√£o √† Sa√∫de (RAS).', topicoId: null }, { hora: 37, materia: 'PESQUISA', foco: '(Eixo 5) 4. Avalia√ß√£o de pol√≠ticas p√∫blicas: Tipos e componentes.', topicoId: null }, { hora: 38, materia: 'REVIS√ÉO GERAL', foco: 'Revis√£o da Semana (Mapas Mentais, Flashcards, etc.).', topicoId: null }, ], progress: { '1': { completed: true, date: '2025-06-16', start:'09:00', end:'09:50', diary:'F√°cil', hits: 8, total: 10, r1: true, r2: false, r3: false }, '2': { completed: true, date: '2025-06-17', start:'10:00', end:'10:55', diary:'Muita decoreba', hits: 13, total: 15, r1: true, r2: false, r3: false }, '7': { completed: true, date: '2025-06-18', start:'14:00', end:'14:45', diary:'Preciso focar mais', hits: 5, total: 10, r1: false, r2: false, r3: false }, } } }, documentos: { 'doc1': { id: 'doc1', title: 'A Metodologia H√©lio', content: '## O Sistema da Aprova√ß√£o\n\nO aprendizado real nasce do esfor√ßo e da estrat√©gia, n√£o do conforto.' } }, tarefas: { 'task1': { id: 'task1', title: 'Fazer inscri√ß√£o no concurso da Receita Federal', dueDate: '2025-07-15', completed: false, description: 'N√£o esquecer de pagar o boleto.' }, 'task2': { id: 'task2', title: 'Comprar novo marca-texto amarelo', dueDate: '2025-06-25', completed: true, description: '' } } },
    };

    class HubHelioFinal {
        constructor(data) {
            this.state = data.state;
        }
        
        init() {
            this.loadState();
            this.updateGamification(); 
            this.setTheme(this.state.theme); 
            this.render(); 
            this.attachEventListeners();
        }
        
        loadState() { try { const s = localStorage.getItem('hubFinalCompleto'); if(s) this.state = JSON.parse(s); this.state.theme = localStorage.getItem('theme') || 'light'; } catch(e) { console.error("Erro ao carregar estado:", e) } }
        
        saveState() { localStorage.setItem('hubFinalCompleto', JSON.stringify(this.state)); }
        
        getActiveConcurso() { return this.state.concursos[this.state.activeConcursoId]; }

        render() {
            const concurso = this.getActiveConcurso();
            if(!concurso){ document.body.innerHTML = '<div class="h-screen flex items-center justify-center text-center"><div><h1 class="text-3xl font-bold">Erro: Nenhum concurso ativo.</h1><p>Por favor, limpe o armazenamento local do seu navegador (localStorage) ou adicione um concurso no c√≥digo-fonte `AppData`.</p></div></div>'; return; }
            document.getElementById('header-subtitle').textContent = `Foco: ${concurso.nome}`;
            this.renderAllTabs();
            this.showTab(this.state.activeTab);
        }

        renderAllTabs() { this.renderDashboard(); this.renderGuias(); this.renderCiclo(); this.renderRevisoes(); this.renderDocumentos(); this.renderTarefas(); this.renderCalendarioGeral(); }
        
        showTab(tabId) { this.state.activeTab = tabId; document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden')); const currentTab = document.getElementById(tabId); if (currentTab) currentTab.classList.remove('hidden'); document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active')); const currentButton = document.querySelector(`button[onclick="app.showTab('${tabId}')"]`); if (currentButton) currentButton.classList.add('active'); if (tabId === 'revisoes') this.renderRevisoes(); if (tabId === 'calendario') this.renderCalendarioGeral(); }

        renderDashboard() { const container = document.getElementById('dashboard'); const concurso = this.getActiveConcurso(); const user = this.state.user; const nextMission = concurso.ciclo.find(item => !concurso.progress[item.hora]?.completed); const { today } = this.getRevisions(); const xpToNextLevel = (user.gamification.level * 100); container.innerHTML = `<div class="grid grid-cols-1 lg:grid-cols-3 gap-6"><div class="lg:col-span-2 space-y-6"><div class="card bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800"><h3 class="font-bold text-xl text-blue-800 dark:text-blue-300 mb-2"><i class="fas fa-bullseye mr-2"></i>Sua Pr√≥xima Miss√£o</h3> ${nextMission ? `<p class="text-lg"><strong>Hora ${nextMission.hora}:</strong> ${nextMission.foco}</p><button class="btn btn-primary mt-4" onclick="app.showTab('ciclo')">Ir para o Ciclo</button>` : `<p class="text-lg text-green-700">Parab√©ns, ciclo conclu√≠do!</p>`}</div><div class="card"><h3 class="font-bold text-xl mb-4"><i class="fas fa-brain text-yellow-500 mr-2"></i>Revis√µes para Hoje (${today.length})</h3> ${today.length > 0 ? `<ul class="space-y-2">${today.map(item => `<li class="flex justify-between items-center p-2 hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-md"><div><span class="font-semibold">H${item.hour}:</span> <span>${item.foco}</span></div><span class="text-xs font-bold text-white p-1 rounded-md bg-red-500">${item.type}</span></li>`).join('')}</ul>` : '<p class="text-gray-500">Nenhuma revis√£o agendada para hoje!</p>'}</div><div class="card"><h3 class="text-xl font-bold mb-4">Anota√ß√µes R√°pidas</h3><textarea id="quick-notes" class="input-style h-24" placeholder="Anote seus insights...">${this.state.quickNotes || ''}</textarea></div></div><div class="space-y-6"><div class="card text-center"><h3 class="text-xl font-bold mb-2">üî• Ofensiva</h3><p class="text-5xl font-black text-orange-500">${user.gamification.streak}</p><p class="text-sm text-gray-500">dias de estudo seguidos</p></div><div class="card"><h3 class="text-xl font-bold mb-2">üèÜ N√≠vel & XP</h3><p class="text-center text-2xl font-bold">N√≠vel ${user.gamification.level}</p><div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-4 mt-2"><div class="bg-gradient-to-r from-yellow-400 to-orange-500 h-4 rounded-full" style="width: ${ (user.gamification.xp / xpToNextLevel) * 100}%"></div></div><p class="text-center text-xs text-gray-500 mt-1">${user.gamification.xp} / ${xpToNextLevel} XP</p></div><div class="card"><h3 class="text-xl font-bold mb-4">√Årea de Foco (Pomodoro)</h3><div class="border rounded-xl overflow-hidden h-48"><iframe src="https://pomofocus.io/app" class="w-full h-full border-0"></iframe></div></div></div></div>`; }
        
        renderGuias() { const container = document.getElementById('guias'); const concurso = this.getActiveConcurso(); const foldersHTML = Object.values(concurso.folders).map(folder => { const disciplinasHTML = Object.values(concurso.disciplinas).filter(d => d.folderId === folder.id).map(d => `<li class="p-2 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800/50 cursor-pointer text-sm" onclick="app.renderTopicosView('${d.id}')"><span>${d.emoji} ${d.name}</span></li>`).join(''); return `<details open class="mb-2"><summary class="font-semibold cursor-pointer p-2 flex justify-between items-center text-base"><span><i class="fas fa-folder text-yellow-500 mr-2"></i>${folder.name}</span><i class="fas fa-chevron-down text-xs"></i></summary><ul class="mt-1 ml-4 border-l-2 pl-2">${disciplinasHTML}</ul></details>`; }).join(''); const concursoOptions = Object.values(this.state.concursos).map(c => `<option value="${c.id}" ${c.id === this.state.activeConcursoId ? 'selected' : ''}>${c.nome}</option>`).join(''); container.innerHTML = `<div class="flex flex-wrap gap-4 justify-between items-center mb-6"><h2 class="text-3xl font-bold">Guia de Estudos</h2><div class="flex flex-wrap gap-2"><select class="input-style w-auto" onchange="app.setActiveConcurso(this.value)">${concursoOptions}</select><button class="btn btn-secondary btn-sm" onclick="app.openConcursoModal()"><i class="fas fa-cogs mr-2"></i>Novo/Gerenciar</button><button class="btn btn-secondary btn-sm" onclick="app.openPastaModal()"><i class="fas fa-folder-plus mr-2"></i>Nova Pasta</button><button class="btn btn-primary btn-sm" onclick="app.openDisciplinaModal()"><i class="fas fa-plus mr-2"></i>Nova Disciplina</button></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-8"><div class="md:col-span-1 card"><h3 class="font-bold text-lg mb-4">Navegador</h3><div id="folders-container">${foldersHTML}</div></div><div id="topicos-content-view" class="md:col-span-2 card"><div class="flex items-center justify-center h-full text-gray-500">Selecione uma disciplina para ver seus t√≥picos.</div></div></div><style>.btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }</style>`; }
        
        renderTopicosView(disciplinaId) { const container = document.getElementById('topicos-content-view'); const concurso = this.getActiveConcurso(); const disciplina = concurso.disciplinas[disciplinaId]; const topicosDaDisciplina = Object.values(concurso.topicos || {}).filter(t => t.disciplinaId === disciplinaId); container.innerHTML = `<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-2xl">${disciplina.emoji} ${disciplina.name}</h3><button class="btn btn-primary btn-sm" onclick="app.openTopicoModal(null, '${disciplinaId}')"><i class="fas fa-plus mr-2"></i>Novo T√≥pico</button></div><div class="space-y-4">${topicosDaDisciplina.length > 0 ? topicosDaDisciplina.map(t => `<details class="p-4 border dark:border-gray-700 rounded-lg group"><summary class="font-semibold cursor-pointer flex justify-between"> ${t.name} <button class="btn btn-secondary btn-sm !p-2 h-7 w-7 text-xs opacity-0 group-hover:opacity-100 transition-opacity" onclick="event.stopPropagation(); app.openTopicoModal('${t.id}')"><i class="fas fa-pencil-alt"></i></button></summary><div class="prose dark:prose-invert max-w-none mt-4 pt-4 border-t" innerHTML="${marked.parse(t.markdown || '')}"></div></details>`).join('') : '<p class="text-gray-500">Nenhum t√≥pico criado.</p>'}</div>`; }
        
        renderCiclo() { const container = document.getElementById('ciclo'); container.innerHTML = `<details class="card mb-6"><summary class="font-bold text-xl cursor-pointer">Tutorial e Sum√°rio do Ciclo - Fase 1</summary><div class="prose dark:prose-invert max-w-none mt-4 pt-4 border-t"><h4>Tutorial de Preenchimento:</h4><ol><li>Marque a checkbox 'OK' ao concluir uma sess√£o de estudo.</li><li>Preencha a 'Data' em que estudou. Isso alimenta o Calend√°rio de Revis√µes.</li><li>(Opcional) Anote hor√°rios, um 'Di√°rio de Bordo' com suas dificuldades, e o resultado em quest√µes.</li><li>Marque as checkboxes de revis√£o (R1, R7, R30) quando realiz√°-las.</li></ol><h4>Sum√°rio da Fase 1 (Funda√ß√£o):</h4><p>Este ciclo de 38 horas foi projetado para construir uma base s√≥lida nas mat√©rias de maior peso e frequ√™ncia, como Portugu√™s, Gest√£o Governamental e RLM, mesclando com os principais t√≥picos dos outros eixos. O objetivo √© chegar ao final destas 38 sess√µes com uma compreens√£o geral de todo o conte√∫do, identificando pontos fortes e fracos para ajustar as pr√≥ximas fases.</p></div></details><div class="card !p-0 overflow-hidden"><div class="overflow-x-auto"><table class="w-full text-sm text-left"> <thead class="text-xs uppercase bg-gray-100 dark:bg-gray-800"><tr> <th class="p-3">OK</th><th class="p-3">Hora</th><th class="p-3">Mat√©ria</th><th class="p-3 min-w-[250px]">T√≥pico</th><th class="p-3">Data</th><th class="p-3">In√≠cio</th><th class="p-3">Fim</th><th class="p-3 min-w-[200px]">Di√°rio</th><th class="p-3 min-w-[180px]">Quest√µes</th><th class="p-3">Revis√µes</th> </tr></thead><tbody id="study-cycle-body"></tbody> </table></div></div>`; this.renderCicloTbody(); }

        renderCicloTbody() { const tbody = document.getElementById('study-cycle-body'); if (!tbody) return; tbody.innerHTML = this.getActiveConcurso().ciclo.map(item => { const itemProgress = this.getActiveConcurso().progress[item.hora] || {}; const isChecked = itemProgress.completed || false; return `<tr class="border-b ${isChecked ? 'bg-green-50 dark:bg-green-900/20 opacity-60' : 'hover:bg-gray-50 dark:hover:bg-gray-800/50'}"> <td class="p-2 text-center"><input type="checkbox" class="h-5 w-5 rounded text-blue-600 focus:ring-blue-500" data-field="completed" data-hour="${item.hora}" ${isChecked ? 'checked' : ''}></td> <td class="p-2 font-bold">${item.hora}</td> <td class="p-2"><span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-200">${item.materia}</span></td> <td class="p-2">${item.foco}</td> <td class="p-2"><input type="date" class="input-style w-32" data-field="date" data-hour="${item.hora}" value="${itemProgress.date || ''}"></td> <td class="p-2"><input type="time" class="input-style w-24" data-field="start" data-hour="${item.hora}" value="${itemProgress.start || ''}"></td> <td class="p-2"><input type="time" class="input-style w-24" data-field="end" data-hour="${item.hora}" value="${itemProgress.end || ''}"></td> <td class="p-2"><textarea class="input-style" rows="1" data-field="diary" data-hour="${item.hora}">${itemProgress.diary || ''}</textarea></td> <td class="p-2"><div class="flex items-center space-x-1"> <input type="number" class="input-style w-16" placeholder="A" data-field="hits" data-hour="${item.hora}" value="${itemProgress.hits || ''}"><span>/</span> <input type="number" class="input-style w-16" placeholder="T" data-field="total" data-hour="${item.hora}" value="${itemProgress.total || ''}"> <span data-field="percentage" data-hour="${item.hora}" class="font-semibold ml-2 w-12 text-center">-</span> </div></td> <td class="p-2 text-center space-y-1 text-xs"> <div><input type="checkbox" class="mr-1" data-field="r1" data-hour="${item.hora}" ${itemProgress.r1 ? 'checked' : ''}><label>24h</label></div> <div><input type="checkbox" class="mr-1" data-field="r2" data-hour="${item.hora}" ${itemProgress.r2 ? 'checked' : ''}><label>7d</label></div> <div><input type="checkbox" class="mr-1" data-field="r3" data-hour="${item.hora}" ${itemProgress.r3 ? 'checked' : ''}><label>30d</label></div> </td> </tr>`; }).join(''); this.getActiveConcurso().ciclo.forEach(item => this.calculatePercentage(item.hora)); }

        renderRevisoes() { const container = document.getElementById('revisoes'); const { today, thisWeek, thisMonth } = this.getRevisions(); const renderRevisionList = (title, items, color) => { if (items.length === 0) return ''; const itemsHTML = items.map(item => `<li class="flex justify-between items-center p-3 hover:bg-gray-50 dark:hover:bg-gray-800/50 rounded-md border-l-4 ${color}"><div class="flex flex-col"><strong>H${item.hour}: ${item.foco}</strong><span class="text-xs text-gray-500">Revis√£o ${item.type} - Vence em ${item.dueDate.toLocaleDateString('pt-BR')}</span></div></li>`).join(''); return `<div class="mb-6"><h3 class="font-bold text-lg mb-2">${title} (${items.length})</h3><ul class="space-y-2">${itemsHTML}</ul></div>`; }; container.innerHTML = `<h2 class="text-3xl font-bold mb-6">Painel de Revis√µes</h2> <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"> <div class="card"><h3 class="text-xl font-bold mb-4">Calend√°rio de Revis√µes Programadas</h3><div id="calendar-container"></div></div> <div class="card"><h3 class="text-xl font-bold mb-4">Lista de Tarefas de Revis√£o</h3><div class="max-h-[600px] overflow-y-auto pr-2">${renderRevisionList('Hoje', today, 'border-red-500')}${renderRevisionList('Esta Semana', thisWeek, 'border-yellow-500')}${renderRevisionList('Este M√™s', thisMonth, 'border-blue-500')}</div></div> </div>`; this.renderCalendar('revisoes'); }

        renderDocumentos() { const container = document.getElementById('documentos'); container.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold">Documentos Estrat√©gicos</h2><button class="btn btn-primary" onclick="app.openDocumentoModal()"><i class="fas fa-plus mr-2"></i>Adicionar Documento</button></div><div class="space-y-4">${Object.values(this.state.documentos).map(d => `<details class="card group"><summary class="font-semibold text-xl cursor-pointer p-2 flex justify-between items-center"><span>${d.title}</span><div class="flex items-center gap-2"><button class="btn btn-secondary btn-sm !p-2 h-7 w-7" onclick="event.stopPropagation(); app.openDocumentoModal('${d.id}')"><i class="fas fa-pencil-alt"></i></button><i class="fas fa-chevron-right group-open:rotate-90 transition-transform"></i></div></summary><div class="prose dark:prose-invert max-w-none mt-4 pt-4 border-t" innerHTML="${marked.parse(d.content)}"></div></details>`).join('') || '<p class="text-gray-500">Nenhum documento adicionado.</p>'}</div>`; }

        renderTarefas() { const container = document.getElementById('tarefas'); const allTasks = Object.values(this.state.tarefas || {}); const pendingTasks = allTasks.filter(t => !t.completed).sort((a,b) => new Date(a.dueDate) - new Date(b.dueDate)); const completedTasks = allTasks.filter(t => t.completed).sort((a,b) => new Date(b.dueDate) - new Date(a.dueDate)); const renderTaskList = (tasks) => tasks.map(task => `<li class="flex items-start gap-3 p-3 border-b dark:border-gray-700"><input type="checkbox" class="h-5 w-5 mt-1 rounded text-blue-600 focus:ring-blue-500" onchange="app.toggleTarefa('${task.id}')" ${task.completed ? 'checked' : ''}><div class="flex-grow"><p class="font-semibold ${task.completed ? 'line-through text-gray-500' : ''}">${task.title}</p><p class="text-xs text-gray-500">Vencimento: ${new Date(task.dueDate + 'T03:00:00').toLocaleDateString('pt-BR')}</p>${task.description ? `<p class="text-sm mt-1 text-gray-600 dark:text-gray-400">${task.description}</p>` : ''}</div><div class="flex gap-2"><button class="btn btn-secondary btn-sm !p-2 h-7 w-7 text-xs" onclick="app.openTarefaModal('${task.id}')"><i class="fas fa-pencil-alt"></i></button></div></li>`).join(''); container.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold">Gerenciador de Tarefas</h2><button class="btn btn-primary" onclick="app.openTarefaModal()"><i class="fas fa-plus mr-2"></i>Nova Tarefa</button></div><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div class="card"><h3 class="text-xl font-bold mb-4">Pendentes (${pendingTasks.length})</h3><ul class="space-y-2">${pendingTasks.length > 0 ? renderTaskList(pendingTasks) : '<p class="text-gray-500">Nenhuma tarefa pendente!</p>'}</ul></div><div class="card"><h3 class="text-xl font-bold mb-4">Conclu√≠das (${completedTasks.length})</h3><ul class="space-y-2">${completedTasks.length > 0 ? renderTaskList(completedTasks) : '<p class="text-gray-500">Nenhuma tarefa conclu√≠da ainda.</p>'}</ul></div></div>`; }
        
        renderCalendarioGeral() { const container = document.getElementById('calendario'); container.innerHTML = `<h2 class="text-3xl font-bold mb-6">Calend√°rio Geral Unificado</h2><div class="card"><div id="geral-calendar-container"></div><div class="mt-4 pt-4 border-t dark:border-gray-700"><h4 class="font-bold mb-2">Legenda:</h4><div class="flex flex-wrap gap-x-4 gap-y-2 text-sm"><span class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-500 mr-2"></span>Revis√£o 24h</span><span class="flex items-center"><span class="w-3 h-3 rounded-full bg-yellow-500 mr-2"></span>Revis√£o 7d</span><span class="flex items-center"><span class="w-3 h-3 rounded-full bg-green-500 mr-2"></span>Revis√£o 30d</span><span class="flex items-center"><i class="fas fa-tasks text-blue-500 mr-2"></i>Tarefa Pendente</span><span class="flex items-center"><i class="fas fa-trophy text-purple-600 mr-2"></i>Data da Prova</span></div></div></div>`; this.renderCalendar('geral'); }

        getRevisions() { let t = [], w = [], m = []; const n = new Date(); n.setHours(0,0,0,0); const eow = new Date(n); eow.setDate(n.getDate() + 7); const eom = new Date(n.getFullYear(), n.getMonth() + 1, 0); const c = this.getActiveConcurso(); if (!c) return { today:t, thisWeek:w, thisMonth:m}; for(const h in c.progress) { const i = c.progress[h]; if (i.date) { const sd = new Date(i.date + 'T03:00:00'); const ci = c.ciclo.find(c => c.hora == h); if (!ci) continue; [{ type: 'R1', days: 1, checked: i.r1 }, { type: 'R2', days: 7, checked: i.r2 }, { type: 'R3', days: 30, checked: i.r3 }].forEach(r => { const d = new Date(sd); d.setDate(sd.getDate() + r.days); d.setHours(0,0,0,0); if (!r.checked && d >= n) { const rd = { hour:h, foco: ci.foco, type: r.type, dueDate: d }; if (d.getTime() === n.getTime()) t.push(rd); else if (d <= eow) w.push(rd); else if (d <= eom) m.push(rd); } }); } } const s = (a, b) => a.dueDate - b.dueDate; return { today: t.sort(s), thisWeek: w.sort(s), thisMonth: m.sort(s) }; }
        
        renderCalendar(type = 'revisoes') { const el = document.getElementById(type === 'revisoes' ? 'calendar-container' : 'geral-calendar-container'); if(!el) return; const n = new Date(); const m = n.getMonth(); const y = n.getFullYear(); const fd = new Date(y, m, 1).getDay(); const dim = new Date(y, m + 1, 0).getDate(); let h = `<div class="flex justify-between items-center mb-4"><h3 class="font-bold text-lg">${n.toLocaleString('pt-BR', { month: 'long', year: 'numeric' }).toUpperCase()}</h3></div><div class="grid grid-cols-7 gap-2 text-center text-xs text-gray-500"><div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div></div><div class="grid grid-cols-7 gap-1 mt-2">`; for (let i = 0; i < fd; i++) { h += `<div></div>`; } for (let d = 1; d <= dim; d++) { const ds = `${y}-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`; const it = new Date(y, m, d).toDateString() === new Date().toDateString(); let eventsHTML = ''; if(type === 'revisoes') { const r = this.getRevisionsForDate(ds); eventsHTML = `<div class="text-xs mt-1 space-y-1 overflow-y-auto">${r.r1 > 0 ? `<div class="bg-red-200 text-red-800 p-0.5 text-center rounded">${r.r1} R1</div>` : ''}${r.r2 > 0 ? `<div class="bg-yellow-200 text-yellow-800 p-0.5 text-center rounded">${r.r2} R2</div>` : ''}${r.r3 > 0 ? `<div class="bg-green-200 text-green-800 p-0.5 text-center rounded">${r.r3} R3</div>` : ''}</div>`; } else { const { reviews, tasks, exams } = this.getCalendarEventsForDate(ds); eventsHTML = `<div class="text-xs mt-1 space-y-1 overflow-y-auto text-left px-1">${reviews.r1 > 0 ? `<div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-red-500"></div> R1 (${reviews.r1})</div>` : ''}${reviews.r2 > 0 ? `<div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-yellow-500"></div> R2 (${reviews.r2})</div>` : ''}${reviews.r3 > 0 ? `<div class="flex items-center gap-1"><div class="w-2 h-2 rounded-full bg-green-500"></div> R3 (${reviews.r3})</div>` : ''}${tasks.length > 0 ? tasks.map(t => `<div class="flex items-center gap-1 truncate"><i class="fas fa-tasks text-blue-500"></i> ${t.title}</div>`).join('') : ''}${exams.length > 0 ? exams.map(e => `<div class="flex items-center gap-1 truncate"><i class="fas fa-trophy text-purple-600"></i> ${e.nome}</div>`).join('') : ''}</div>`; } h += `<div class="p-1 border dark:border-gray-700 rounded-lg h-24 flex flex-col ${it ? 'bg-blue-100 dark:bg-blue-900/50 ring-2 ring-blue-400' : ''}"><div class="font-bold text-sm text-center">${d}</div>${eventsHTML}</div>`; } h += `</div>`; el.innerHTML = h; }

        getRevisionsForDate(ds) { const r = { r1: 0, r2: 0, r3: 0 }; const c = this.getActiveConcurso(); if (!c) return r; for(const h in c.progress) { const i = c.progress[h]; if (i.date) { const sd = new Date(i.date + 'T03:00:00'); [{ checked: i.r1, days: 1, type: 'r1' }, { checked: i.r2, days: 7, type: 'r2' }, { checked: i.r3, days: 30, type: 'r3' }].forEach(rev => { const d = new Date(sd); d.setDate(sd.getDate() + rev.days); if (!rev.checked && d.toISOString().split('T')[0] === ds) r[rev.type]++; }); } } return r; }
        
        getCalendarEventsForDate(dateString) { const reviews = this.getRevisionsForDate(dateString); const tasks = Object.values(this.state.tarefas).filter(t => t.dueDate === dateString && !t.completed); const exams = Object.values(this.state.concursos).filter(c => c.dataProva === dateString); return { reviews, tasks, exams }; }

        handleCicloChange(event) { const t = event.target; const h = t.dataset.hour; const f = t.dataset.field; const c = this.getActiveConcurso(); if (!c.progress[h]) c.progress[h] = {}; const v = t.type === 'checkbox' ? t.checked : t.value; c.progress[h][f] = v; if (f === 'completed') { if(t.checked) this.addXP(10); this.renderCicloTbody(); this.renderDashboard(); } if (f === 'hits' || f === 'total') this.calculatePercentage(h); if (f === 'date' || f.startsWith('r')) { this.renderRevisoes(); this.renderCalendarioGeral(); } this.saveState(); }
        
        calculatePercentage(h) { const p = this.getActiveConcurso().progress[h] || {}; const s = document.querySelector(`span[data-field='percentage'][data-hour='${h}']`); if(s && p.hits && p.total > 0) { const perc = Math.round(p.hits/p.total*100); s.textContent = `${perc}%`; s.className = `font-semibold ml-2 w-12 text-center ${perc < 60 ? 'text-red-500' : perc < 80 ? 'text-yellow-500' : 'text-green-500'}`; } else if(s) { s.textContent = '-'; } }
        
        updateGamification() { const today = new Date().toDateString(); const gam = this.state.user.gamification; if(gam.lastLogin !== today) { const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1); gam.streak = gam.lastLogin === yesterday.toDateString() ? gam.streak + 1 : 1; gam.lastLogin = today; this.addXP(5); this.saveState(); }}
        
        addXP(points) { const gam = this.state.user.gamification; gam.xp += points; const xpToNextLevel = gam.level * 100; if(gam.xp >= xpToNextLevel) { gam.level++; gam.xp -= xpToNextLevel; }}
        
        openModal(modalHTML) { document.getElementById('main-modal-container').innerHTML = modalHTML; document.querySelector('.modal')?.classList.add('active'); }
        
        closeModal() { document.getElementById('main-modal-container').innerHTML = ''; }
        
        openConcursoModal(id = null) { const c = id ? this.state.concursos[id] : null; this.openModal(`<div class="modal fixed inset-0 bg-gray-900 bg-opacity-60 overflow-y-auto h-full w-full flex justify-center items-center z-50"><div class="relative mx-auto p-6 border w-full max-w-lg shadow-lg rounded-xl bg-white dark:bg-gray-800"><h3 class="text-2xl font-bold text-center">${c ? 'Editar' : 'Novo'} Concurso</h3><div class="mt-4 space-y-3"><input type="hidden" id="concurso-id" value="${id || ''}"><div class="text-left"><label class="text-sm font-medium">Nome do Concurso</label><input type="text" id="concurso-nome" class="input-style" value="${c?.nome || ''}" placeholder="Ex: TJ-SP Interior"></div><div class="grid grid-cols-2 gap-4"><div class="text-left"><label class="text-sm font-medium">Banca</label><input type="text" id="concurso-banca" class="input-style" value="${c?.banca || ''}" placeholder="Ex: VUNESP"></div><div class="text-left"><label class="text-sm font-medium">Data da Prova</label><input type="date" id="concurso-data" class="input-style" value="${c?.dataProva || ''}"></div></div><div class="grid grid-cols-2 gap-4"><div class="text-left"><label class="text-sm font-medium">Status</label><input type="text" id="concurso-status" class="input-style" value="${c?.status || ''}" placeholder="Ex: Edital Publicado"></div><div class="text-left"><label class="text-sm font-medium">Link do Edital</label><input type="url" id="concurso-link" class="input-style" value="${c?.linkEdital || ''}" placeholder="https://..."></div></div></div><div class="flex justify-end gap-3 mt-6"><button class="btn btn-secondary" onclick="app.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="app.saveConcurso()">Salvar</button></div></div></div>`); }
        
        saveConcurso() { const id = document.getElementById('concurso-id').value || `c_${Date.now()}`; const nome = document.getElementById('concurso-nome').value; if(!nome) return alert('O nome do concurso √© obrigat√≥rio.'); const isNew = !this.state.concursos[id]; const baseConcurso = isNew ? JSON.parse(JSON.stringify(this.state.concursos[this.state.activeConcursoId])) : this.state.concursos[id]; this.state.concursos[id] = { ...baseConcurso, id, nome: nome, banca: document.getElementById('concurso-banca').value, dataProva: document.getElementById('concurso-data').value, status: document.getElementById('concurso-status').value, linkEdital: document.getElementById('concurso-link').value, }; if(isNew) { this.state.concursos[id].progress = {}; this.state.concursos[id].folders = {}; this.state.concursos[id].disciplinas = {}; this.state.concursos[id].topicos = {}; } this.setActiveConcurso(id); this.renderGuias(); this.closeModal(); this.saveState(); }

        openPastaModal() { this.openModal(`<div class="modal fixed inset-0 bg-gray-900 bg-opacity-60 overflow-y-auto h-full w-full justify-center items-center z-50"><div class="relative mx-auto p-6 border w-full max-w-lg shadow-lg rounded-xl bg-white dark:bg-gray-800"><h3 class="text-2xl font-bold text-center">Nova Pasta</h3><div class="mt-4 text-left"><label>Nome da Pasta</label><input type="text" id="pasta-name" class="input-style"></div><div class="flex justify-end gap-3 mt-6"><button class="btn btn-secondary" onclick="app.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="app.savePasta()">Salvar</button></div></div></div>`);}
        savePasta() { const name = document.getElementById('pasta-name').value; if(!name) return; const id = `f_${Date.now()}`; this.getActiveConcurso().folders[id] = {id, name}; this.renderGuias(); this.closeModal(); this.saveState(); }
        openDisciplinaModal() { const concurso = this.getActiveConcurso(); const folderOptions = Object.values(concurso.folders).map(f => `<option value="${f.id}">${f.name}</option>`).join(''); this.openModal(`<div class="modal fixed inset-0 bg-gray-900 bg-opacity-60 overflow-y-auto h-full w-full justify-center items-center z-50"><div class="relative mx-auto p-6 border w-full max-w-lg shadow-lg rounded-xl bg-white dark:bg-gray-800"><h3 class="text-2xl font-bold text-center">Nova Disciplina</h3><div class="mt-4 space-y-3 text-left"><div><label>Nome</label><input type="text" id="d-name" class="input-style"></div><div><label>Emoji</label><input type="text" id="d-emoji" class="input-style"></div><div><label>Pasta</label><select id="d-folderId" class="input-style">${folderOptions}</select></div></div><div class="flex justify-end gap-3 mt-6"><button class="btn btn-secondary" onclick="app.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="app.saveDisciplina()">Salvar</button></div></div></div>`); }
        saveDisciplina() { const id = `d_${Date.now()}`; this.getActiveConcurso().disciplinas[id] = { id, name: document.getElementById('d-name').value, emoji: document.getElementById('d-emoji').value, folderId: document.getElementById('d-folderId').value }; this.renderGuias(); this.closeModal(); this.saveState(); }
        openTopicoModal(id = null, disciplinaId = null) { const topico = id ? this.getActiveConcurso().topicos[id] : null; this.openModal(`<div class="modal fixed inset-0 bg-gray-900 bg-opacity-60 overflow-y-auto h-full w-full justify-center items-center z-50"><div class="relative mx-auto p-6 border w-full max-w-2xl shadow-lg rounded-xl bg-white dark:bg-gray-800"><h3 class="text-2xl font-bold text-center">${id ? 'Editar' : 'Novo'} T√≥pico</h3><div class="mt-4 space-y-3 text-left"><input type="hidden" id="t-id" value="${id || ''}"><input type="hidden" id="t-disciplinaId" value="${disciplinaId || topico?.disciplinaId}"><label>Nome do T√≥pico</label><input type="text" id="t-name" class="input-style" value="${topico?.name || ''}"><label>Anota√ß√µes (Markdown)</label><textarea id="t-markdown" class="input-style h-48">${topico?.markdown || ''}</textarea></div><div class="flex justify-end gap-3 mt-6"><button class="btn btn-secondary" onclick="app.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="app.saveTopico()">Salvar</button></div></div></div>`); }
        saveTopico() { const id = document.getElementById('t-id').value || `t_${Date.now()}`; const disciplinaId = document.getElementById('t-disciplinaId').value; this.getActiveConcurso().topicos[id] = { id, disciplinaId, name: document.getElementById('t-name').value, markdown: document.getElementById('t-markdown').value }; this.renderTopicosView(disciplinaId); this.closeModal(); this.saveState(); }
        openDocumentoModal(id=null){ const d = id ? this.state.documentos[id] : null; this.openModal(`<div class="modal fixed inset-0 bg-gray-900 bg-opacity-60 overflow-y-auto h-full w-full justify-center items-center z-50"><div class="relative mx-auto p-6 border w-full max-w-2xl shadow-lg rounded-xl bg-white dark:bg-gray-800"><h3 class="text-2xl font-bold text-center">${id ? 'Editar' : 'Novo'} Documento</h3><div class="mt-4 space-y-3 text-left"><input type="hidden" id="doc-id" value="${id || ''}"><label>T√≠tulo</label><input type="text" id="doc-title" class="input-style" value="${d?.title || ''}"><label>Conte√∫do (Markdown)</label><textarea id="doc-content" class="input-style h-64">${d?.content || ''}</textarea></div><div class="flex justify-between items-center mt-6">${id ? `<button class="btn !bg-red-100 !text-red-700 hover:!bg-red-200" onclick="app.deleteDocumento('${id}')">Excluir</button>` : '<div></div>'}<div class="flex gap-3"><button class="btn btn-secondary" onclick="app.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="app.saveDocumento()">Salvar</button></div></div></div></div>`);}
        saveDocumento() { let id = document.getElementById('doc-id').value || `doc_${Date.now()}`; this.state.documentos[id] = {id, title: document.getElementById('doc-title').value, content: document.getElementById('doc-content').value}; this.renderDocumentos(); this.closeModal(); this.saveState(); }
        deleteDocumento(id) { if(confirm('Tem certeza que deseja excluir este documento?')){ delete this.state.documentos[id]; this.renderDocumentos(); this.closeModal(); this.saveState(); }}
        
        openTarefaModal(id = null) { const task = id ? this.state.tarefas[id] : null; this.openModal(`<div class="modal fixed inset-0 bg-gray-900 bg-opacity-60 overflow-y-auto h-full w-full justify-center items-center z-50"><div class="relative mx-auto p-6 border w-full max-w-lg shadow-lg rounded-xl bg-white dark:bg-gray-800"><h3 class="text-2xl font-bold text-center">${task ? 'Editar' : 'Nova'} Tarefa</h3><div class="mt-4 space-y-3 text-left"><input type="hidden" id="task-id" value="${id || ''}"><label>T√≠tulo da Tarefa</label><input type="text" id="task-title" class="input-style" value="${task?.title || ''}"><label>Data de Vencimento</label><input type="date" id="task-dueDate" class="input-style" value="${task?.dueDate || ''}"><label>Descri√ß√£o (Opcional)</label><textarea id="task-description" class="input-style h-24">${task?.description || ''}</textarea></div><div class="flex justify-between items-center mt-6">${id ? `<button class="btn !bg-red-100 !text-red-700 hover:!bg-red-200" onclick="app.deleteTarefa('${id}')">Excluir</button>` : '<div></div>'}<div class="flex gap-3"><button class="btn btn-secondary" onclick="app.closeModal()">Cancelar</button><button class="btn btn-primary" onclick="app.saveTarefa()">Salvar</button></div></div></div></div>`); }
        
        saveTarefa() { const id = document.getElementById('task-id').value || `task_${Date.now()}`; const title = document.getElementById('task-title').value; const dueDate = document.getElementById('task-dueDate').value; if (!title || !dueDate) return alert('T√≠tulo e data de vencimento s√£o obrigat√≥rios.'); this.state.tarefas[id] = { id, title, dueDate, description: document.getElementById('task-description').value, completed: this.state.tarefas[id]?.completed || false }; this.renderTarefas(); this.renderCalendarioGeral(); this.closeModal(); this.saveState(); }
        
        deleteTarefa(id) { if (confirm('Tem certeza que deseja excluir esta tarefa?')) { delete this.state.tarefas[id]; this.renderTarefas(); this.renderCalendarioGeral(); this.closeModal(); this.saveState(); } }
        
        toggleTarefa(id) { if (this.state.tarefas[id]) { this.state.tarefas[id].completed = !this.state.tarefas[id].completed; this.renderTarefas(); this.renderCalendarioGeral(); this.saveState(); } }

        setActiveConcurso(id) { this.state.activeConcursoId = id; this.render(); this.saveState(); }
        
        setTheme(themeName) {
            const html = document.documentElement;
            const toggleBtn = document.getElementById('theme-toggle');

            html.classList.remove('dark');
            if (themeName === 'dark') {
                html.classList.add('dark');
            }

            this.state.theme = themeName;
            localStorage.setItem('theme', themeName);

            if (toggleBtn) {
                toggleBtn.innerHTML = themeName === 'dark' ? `<i class="fas fa-sun"></i>` : `<i class="fas fa-moon"></i>`;
            }
        }

        toggleDarkMode() {
            const newTheme = this.state.theme === 'dark' ? 'light' : 'dark';
            this.setTheme(newTheme);
        }

        attachEventListeners() { 
            document.getElementById('theme-toggle').addEventListener('click', () => this.toggleDarkMode());
            
            const appEl = document.getElementById('app'); 
            appEl.addEventListener('input', e => { 
                if (e.target.closest('#study-cycle-body')) this.handleCicloChange(e); 
                if (e.target.id === 'quick-notes') { this.state.quickNotes = e.target.value; this.saveState(); }
            }); 
            
            appEl.addEventListener('change', e => { 
                if (e.target.closest('#study-cycle-body')) this.handleCicloChange(e); 
            }); 
            
            document.getElementById('main-modal-container').addEventListener('click', e => { 
                if(e.target.matches('.modal')) this.closeModal(); 
            }); 
        }
    }

    const app = new HubHelioFinal(AppData);
    app.init();
    </script>
</body>
</html>